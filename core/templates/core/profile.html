{% extends 'core/base.html' %}
{% load static %}

{% block title %}Profile - NFC Payment System{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Profile</h1>
    <!-- Add profile content here -->
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Profile Update Form
    const profileForm = document.getElementById('profileForm');
    profileForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        try {
            const response = await axios.post('/api/profile/update/', Object.fromEntries(formData));
            showAlert('Profile updated successfully', 'success');
        } catch (error) {
            showAlert(error.response?.data?.message || 'Failed to update profile', 'error');
        }
    });

    // Password Change Form
    const passwordForm = document.getElementById('passwordForm');
    passwordForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        if (formData.get('new_password') !== formData.get('confirm_password')) {
            showAlert('New passwords do not match', 'error');
            return;
        }

        try {
            const response = await axios.post('/api/profile/change-password/', Object.fromEntries(formData));
            showAlert('Password updated successfully', 'success');
            this.reset();
        } catch (error) {
            showAlert(error.response?.data?.message || 'Failed to update password', 'error');
        }
    });

    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `fixed top-4 right-4 p-4 rounded-lg ${
            type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
        }`;
        alertDiv.textContent = message;
        document.body.appendChild(alertDiv);
        setTimeout(() => alertDiv.remove(), 3000);
    }
});
</script>
{% endblock %}
